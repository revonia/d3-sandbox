<!DOCTYPE html>
<html style="height: 100%">
<head>
  <meta charset="UTF-8">
  <title>Preview</title>
  <script type="application/javascript">

    window.addEventListener("message", function (event) {
      const data = event.data;
      ['json', 'css', 'html', 'js'].forEach(type => {
        if (typeof data[type] !== 'undefined') {
          $$loadResource(type, data[type])
        }
      })
    }, false);

    var jsonResource = {}

    function $$loadResource (type, content) {
      switch (type) {
        case 'js':
          try {
            eval(content)
          } catch (e) {
            const pre = document.createElement("pre");
            pre.appendChild(document.createTextNode(e));
            document.body.insertBefore(pre, document.body.firstChild);
          }
          break;
        case 'css':
          const tag = document.createElement("style");
          tag.innerHTML = content;
          document.body.appendChild(tag);
          break;
        case 'html':
          document.body.innerHTML += content
          break;
        case 'json':
          jsonResource = JSON.parse(content)
          break;
      }
    }
  </script>
</head>
<body>
</body>
</html>
